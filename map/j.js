async function main(){const g=await fetch("https://data.busrouter.sg/v1/routes.geojson").then(o=>o.json()),a=await fetch("https://data.busrouter.sg/v1/services.json").then(o=>o.json()),e=await fetch("https://data.busrouter.sg/v1/stops.geojson").then(o=>o.json()),u=Math.floor(Math.random()*e.features.length),d=Math.floor(Math.random()*e.features.length),i={number:e.features[u].id,location:e.features[u].geometry.coordinates,name:e.features[u].properties.name,services:e.features[u].properties.services,road:e.features[u].properties.road},c={number:e.features[d].id,location:e.features[d].geometry.coordinates,name:e.features[d].properties.name,services:e.features[d].properties.services,road:e.features[d].properties.road};i.services.some(o=>c.services.includes(o))&&location.reload();const r=L.map("map").setView([1.3521,103.8198],12);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(r);const h=L.circleMarker([i.location[1],i.location[0]],{color:"red"}).addTo(r),v=L.circleMarker([c.location[1],c.location[0]],{color:"red"}).addTo(r);h.bindPopup(`<div>${i.name}<br>${showbuses(i.services)}</div>`),v.bindPopup(`<div>${c.name}<br>${showbuses(c.services)}</div>`);let M,k=[h,v];h.on("popupopen",b),v.on("popupopen",b);function b(){document.querySelectorAll("button").forEach(t=>{let m;const p=`hsl(${Math.random()*360},100%,50%)`;t.addEventListener("mouseover",()=>{M=L.geoJSON(C(t.textContent),{style:{color:p}}).addTo(r),m=!1}),t.addEventListener("mouseout",()=>{m||r.removeLayer(M)}),t.addEventListener("click",()=>{m=!0,(a[t.textContent].routes[1]?a[t.textContent].routes[0].concat(a[t.textContent].routes[1]):a[t.textContent].routes[0]).forEach(l=>{if(l!=i.number&&l!=c.number){const f={name:e.features.filter(n=>n.id==l)[0].properties.name,services:e.features.filter(n=>n.id==l)[0].properties.services,location:e.features.filter(n=>n.id==l)[0].geometry.coordinates},y=L.circleMarker([f.location[1],f.location[0]],{color:p}).addTo(r);y.bindPopup(`${f.name}<br>${showbuses(f.services)}</div>`),y.on("popupopen",b),y.on("popupopen",n=>{k.push(n.target),r.eachLayer(s=>{if(s instanceof L.CircleMarker){const j={location:[s.getLatLng().lng,s.getLatLng().lat]}}}),r.eachLayer(s=>{s instanceof L.CircleMarker&&!k.includes(s)&&r.removeLayer(s),s!=n.target&&s.unbindPopup()})})}}),r.closePopup()})})}function C(o){const t=g.features.filter(p=>p.properties.number==o);return t.length==0?void 0:{type:"Feature",geometry:{type:"MultiLineString",coordinates:t.map(p=>p.geometry.coordinates)},properties:{}}}}function showbuses(g){let a="";return g.forEach(e=>{a+=`<button>${e}</button>`}),a}main();
